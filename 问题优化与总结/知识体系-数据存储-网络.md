

## 常见网络协议

```
                  +-----------------+
                  |    HTTP/2       |
                  +-----------------+
                  |     WebSocket   |
                  |      +----------+
                  |      |  HTTPs   |
+-----------+     +-----------------+
| Http/3    |     | Http | TLS/SSL  |
|  QUIC     +-----+------+----------+
|           |    Socket             |
+-----------------------------------+
|  UDP      |      TCP              |
+-----------+-----------------------+
|          DNS(1RTT)                |
+-----------+-----------------------+



+------------+--------+-----------+------------+----------+
|            |        |           |            |          |
|            |  tcp   |   Https   |  websocket |  Http/3 (QUIC)|
+---------------------------------------------------------+
|            |        |           |            |          |
|handshake   |  3     |           |            |   0/1    |
+---------------------------------------------------------+
|            |        |           |            |          |
|performation|        |           |            |          |
| (RTT)      |  1     |  7(worst) |2(tcp+http) |          |          
|            |        |           |            |          |
+------------+--------+-----------+------------+----------+
https://www.cnblogs.com/mylanguage/p/5635524.html
https://liudanking.com/network/tls1-3-quic-是怎样做到-0-rtt-的/

```
HTTP（HTTPS）所有数据都作为文本处理，广泛应用于网络访问，是公有协议，有专门机构维护。
RTSP流媒体协议，多用在监控领域视频直播点播；是公有协议，有专门机构维护。
RTMP流媒体协议，多用在互联网直播领域（RTMP+CDN）、视频会议（取代原来SIP），是Adobe的私有协议,未完全公开。
RTSP传输一般需要2-3个通道，命令和数据通道分离，HTTP和RTMP一般在TCP一个通道上传输命令和数据。RTMP协议一般传输的是flv，f4v格式流，RTSP协议一般传输的是ts,mp4格式的流。HTTP没有特定的流。

## 算法（编码，数字摘要，加密/密钥协商/密钥交换）
``` 
+--------------------------------------------------------------------------+
|                                                                          |
|                    +--------------------+--------------------------------+
|                    | MIME      URL      |  Base64   url/email            |
+--------------------+--------------------+--------------------------------+
|       (hash)                                                             |
|                 MD5 SHA-1 SHA256                                         |
+--------------------------------------------------------------------------+
|       RSA DH                                                             |
+--------------------------------------------------------------------------+
|       AES                                                                |
+--------------------------------------------------------------------------+
|       TCP/IP                                                             |
+--------------------------------------------------------------------------+

```
## TCP/IP

```
+---------------------------------------------------------------------------+
|  TCP/IP Protocol Architecture Model                                       |
+---------------------+----------------------+------------------------------+
|  OSI Ref. Layer No. | OSI Layer Equivalent |  TCP/IP Protocol Examples    |
+---------------------------------------------------------------------------+
|                     |     Application,     | NFS, NIS+, DNS, telnet ,     |
|  5,6,7              |     session,         |  ftp , rlogin , rsh , rcp ,  |
|                     |     presentation     | RIP, RDISC, SNMP, and others |RPC
+---------------------------------------------------------------------------+
|  4                  |     Transport        |     TCP, UDP                 |TCP还支持重传，错误校验，保证数据的可靠性,UDP不支持重传，有校验
+---------------------------------------------------------------------------+
|  3                  |     Network          |     IP, ARP, ICMP            |拥塞控制和路由选择
+---------------------------------------------------------------------------+
|  2                  |     Data link        |    PPP, IEEE 802.2           |
+---------------------+----------------------+------------------------------+

```
 
TCP：面向连接、传输可靠(保证数据正确性,保证数据顺序)、用于传输大量数据(流模式)、速度慢，建立连接需要开销较多(时间，系统资源)，一般用于文件传输、邮件需要精确的操作。
UDP：面向非连接、传输不可靠、用于传输少量数据(数据包模式)、速度快，一般用于即时通信、在线视频需要低延迟的操作。
```

```

TCP如何保证可靠的？
通过顺序编号和确认（ACK）来实现的

1. 流量控制是管理两端的流量，以免会产生发送过块导致收端溢出，或者因收端处理太快而浪费时间的状态。
   流量控制就是让发送方的发送速率不要太快，要让接收方来得及接收。
   用的是：滑动窗口，以字节为单位

2. 拥塞控制：如果网络上的负载（发送到网络上的分组数）大于网络上的容量（网络同时能处理的分组数），就可能引起拥塞。
判断网络拥塞的两个因素：延时和吞吐量。
拥塞控制机制是：开环（预防）和闭环（消除）
tcp处理拥塞的三种策略：慢启动（指数增大），拥塞避免（加法增大），拥塞检测（除2减少，或叫做乘法减少），快速重传，快速恢复 

3. 差错控制：TCP必须保证数据：按序，没有差错，没有部分丢失，没有重复的交给应用层。方法就是：校验和，确认，超时重传
## RPC

mqtt/xmqq/CoAP 协议
XMPP的优点：协议成熟、强大、可扩展性强、目前主要应用于许多聊天系统中。缺点：协议较复杂、冗余（基于XML）、费流量、费电，部署硬件成本高。
MQTT的优点：协议简洁、小巧、可扩展性强、省流量、省电。缺点：不够成熟、实现较复杂、服务端组件rsmb不开源，部署硬件成本较高。

## mqtt 
[Protocol Specifications](http://mqtt.org/documentation)
```
+-----------------------------------------------------------------+                     +-----------------------------------+
|                                                                 |                     |     Broker                        |
|                                         +-------------------+   |                     |                                   |
|                                         |  Publish          |   |      Topic          |                                   |
|                                         |                   |  +-------------------------->                               |
|                                    +->  |                   |   |                     |                                   |
|                                    |    +-------------------+   |                     |                                   |
| +--------------------------------+ |                            |                     |                                   |
| |             Fixed header       |+|                            |                     |                                   |
| +--------------------------------+      +-------------------+   |                     |                                   |
| |                                |      |  Subscribe        |  +--------------------------->                              |
| |             Variable header    |      |                   |   |                     |                                   |
| +--------------------------------+  +-> |                   |   |                     |                                   |
| |                                |      |                   |  <---------------------------+                              |
| |             payload            |      |                   |   |                     |                                   |
| +--------------------------------+      +-------------------+   |                     |                                   |
+-----------------------------------------------------------------+                     +-----------------------------------+

```


```Fixed header

+---+---+---+---+---+---+---+---+
|   |   |   |   |   |   |   |   |
| 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |bit
|   |   |   |   |   |   |   |   |
+---+---+---+-----------+-------+
|               | D |       |   |
| Message Type  | U | Qos   | R |
|               | P |       |   |
+---------------+---+-------+---+
|                               |
|       Remaining Length        |
|                               |
+-------------------------------+

```
### 消息体
``` [智物客](https://blog.csdn.net/illusion116/article/details/76623014 )
（1）CONNECT，消息体内容主要是：客户端的ClientID、订阅的Topic、Message以及用户名和密码。
（2）SUBSCRIBE，消息体内容是一系列的要订阅的主题以及QoS。
（3）SUBACK，消息体内容是服务器对于SUBSCRIBE所申请的主题及QoS进行确认和回复。
（4）UNSUBSCRIBE，消息体内容是要订阅的主题。
``` 
  
### eclipse mqtt lib / ibm broker


broker
- [Eclipse Mosquitto](https://mosquitto.org/)
- [moquette](https://github.com/andsel/moquette)


## xmpp
```
+----------------------------------+                  +----------------------------------+
|  asmack                          |  +------------>  |  openfire                        |
|                                  |                  |                                  |
+----------------------------------+  <------------+  |                                  |
|   XMPP                           |                  |                                  |
|                                  |                  |                                  |
|   ^message/^,^presence/^,^iq/^   |                  |                                  |
|                                  |                  |                                  |
+----------------------------------+                  |                                  |
|                                  |                  |                                  |
|     SASL                         |                  |                                  |
+----------------------------------+                  |                                  |
|                                  |                  |                                  |
|     TSL                          |                  |                                  |
+----------------------------------+                  |                                  |
|     TCP                          |                  |                                  |
|                                  |                  |                                  |
+----------------------------------+                  +----------------------------------+


```
    1.其中TCP保证了这是一个可靠的链路。
    2.TSL主要采用STARTTLS加密算法保证传输数据的安全。
    3.SASL用来认证客户端的真实有效性。
### 协议
Jabber协议
XMPP通信原语有3种：message、presence和iq。


### 服务器实现 openfire，spark


### 客户端实现 smack asmack