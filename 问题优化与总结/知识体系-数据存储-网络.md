## 算法（编码，数字摘要，加密/密钥协商/密钥交换）
``` 
+--------------------------------------------------------------------------+
|                                                                          |
|                    +--------------------+--------------------------------+
|                    | MIME      URL      |  Base64   url/email            |
+--------------------+--------------------+--------------------------------+
|       (hash)                                                             |
|                 MD5 SHA-1 SHA256                                         |
+--------------------------------------------------------------------------+
|       RSA DH                                                             |
+--------------------------------------------------------------------------+
|       AES                                                                |
+--------------------------------------------------------------------------+

```
## RPC

mqtt/xmqq/CoAP 协议
XMPP的优点：协议成熟、强大、可扩展性强、目前主要应用于许多聊天系统中。缺点：协议较复杂、冗余（基于XML）、费流量、费电，部署硬件成本高。
MQTT的优点：协议简洁、小巧、可扩展性强、省流量、省电。缺点：不够成熟、实现较复杂、服务端组件rsmb不开源，部署硬件成本较高。

## mqtt 
[Protocol Specifications](http://mqtt.org/documentation)
```
+-----------------------------------------------------------------+                     +-----------------------------------+
|                                                                 |                     |     Broker                        |
|                                         +-------------------+   |                     |                                   |
|                                         |  Publish          |   |      Topic          |                                   |
|                                         |                   |  +-------------------------->                               |
|                                    +->  |                   |   |                     |                                   |
|                                    |    +-------------------+   |                     |                                   |
| +--------------------------------+ |                            |                     |                                   |
| |             Fixed header       |+|                            |                     |                                   |
| +--------------------------------+      +-------------------+   |                     |                                   |
| |                                |      |  Subscribe        |  +--------------------------->                              |
| |             Variable header    |      |                   |   |                     |                                   |
| +--------------------------------+  +-> |                   |   |                     |                                   |
| |                                |      |                   |  <---------------------------+                              |
| |             payload            |      |                   |   |                     |                                   |
| +--------------------------------+      +-------------------+   |                     |                                   |
+-----------------------------------------------------------------+                     +-----------------------------------+

```


```Fixed header

+---+---+---+---+---+---+---+---+
|   |   |   |   |   |   |   |   |
| 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |bit
|   |   |   |   |   |   |   |   |
+---+---+---+-----------+-------+
|               | D |       |   |
| Message Type  | U | Qos   | R |
|               | P |       |   |
+---------------+---+-------+---+
|                               |
|       Remaining Length        |
|                               |
+-------------------------------+

```
### 消息体
``` [智物客](https://blog.csdn.net/illusion116/article/details/76623014 )
（1）CONNECT，消息体内容主要是：客户端的ClientID、订阅的Topic、Message以及用户名和密码。
（2）SUBSCRIBE，消息体内容是一系列的要订阅的主题以及QoS。
（3）SUBACK，消息体内容是服务器对于SUBSCRIBE所申请的主题及QoS进行确认和回复。
（4）UNSUBSCRIBE，消息体内容是要订阅的主题。
``` 
  
### eclipse mqtt lib / ibm broker


broker
- [Eclipse Mosquitto](https://mosquitto.org/)
- [moquette](https://github.com/andsel/moquette)


## xmpp
```
+----------------------------------+                  +----------------------------------+
|  asmack                          |  +------------>  |  openfire                        |
|                                  |                  |                                  |
+----------------------------------+  <------------+  |                                  |
|   XMPP                           |                  |                                  |
|                                  |                  |                                  |
|   ^message/^,^presence/^,^iq/^   |                  |                                  |
|                                  |                  |                                  |
+----------------------------------+                  |                                  |
|                                  |                  |                                  |
|     SASL                         |                  |                                  |
+----------------------------------+                  |                                  |
|                                  |                  |                                  |
|     TSL                          |                  |                                  |
+----------------------------------+                  |                                  |
|     TCP                          |                  |                                  |
|                                  |                  |                                  |
+----------------------------------+                  +----------------------------------+


```
    1.其中TCP保证了这是一个可靠的链路。
    2.TSL主要采用STARTTLS加密算法保证传输数据的安全。
    3.SASL用来认证客户端的真实有效性。
### 协议
XMPP通信原语有3种：message、presence和iq。


### 服务器实现 openfire，spark


### 客户端实现 smack asmack