##
```
+------------------------------------------------------------+
|  培训/沟通                                                  |
+------------------------------------------------------------+
|  Project(documents)                                        |
+------------------------------------------------------------+
|  Application                                               |
+------------------------------------------------------------+
|  API(Application Programming Interface) (compiler/tools )  |
+------------------------------------------------------------+
|  knowledge                                                 |
+------------------------------------------------------------+

```
##
高耦合产生问题
- 修改代码，改动量大，造成程序不稳定，容易产生异常，错误等问题
[架构,框架,设计模式](https://blog.csdn.net/CillyB/article/details/79464339)
[软件架构、框架、模式、模块、组件、插件概念汇总 ](https://www.cnblogs.com/doit8791/p/6129963.html)
### 数据架构 -MVC

```
                 +--------------------+
                 |  View              |
       +------+  |                    |  < - +
       |         | disply view/control|      |
       |         | layouts            |
       |         +--------------------+      | update
       | e^ents/
       v user action                          +

+-------------+                   +---------------+
|             |                   |    Model      |
|   Control   |    +---------->   |               |
|             |                   | serialize     |
|             |   data operation  | operation     |
+-------------+                   +---------------+

 
```

### 数据结构 - MVP
MVP的目的就是解藕，把业务逻辑，网络请求丢在P层，页面不发生变化，就只用改P层逻辑，从而达到了解藕的目的

```
+-----------------+             +------------------+            +------------------+
|                 | <--------+  |                  | < - - - +  |                  |
|                 |             |                  |            |                  |
|   View          |             |  presenter       |            |   model          |
|                 |             |                  |            |                  |
|                 | +-------->  |                  | +--------> |                  |
+-----------------+             +------------------+            +------------------+

```
相对与MVP，解耦View和Model
####  MVP实现库 Mosby

### MVVM
```
+-----------------+             +------------------+            +------------------+
|                 | <--------+  |                  | < - - - +  |                  |
|                 |             |                  |            |                  |
|   View          |             |  presenter       |            |   model          |
|                 |             |                  |            |                  |
|                 | ----------  |                  | +--------> |                  |
+-----------------+             +------------------+            +------------------+

```


## 数据通讯- 进程通信方式

### RPC

### IDL 

### IPC

1. Android Binder（AIDL/服务，Messenger/Handler,contentProvider，广播）
2. 文件
3. Socket
进程间（内）通信
本质:通过 Binder 实现，AIDL定义服务，对 Parcelable 对象序列化与反序列化，传输数据

其他进程间通信方式：**文件**，**Socket** （引用于《Android 开发艺术探索》 ）


- 只有允许不同应用的客户端用 IPC 方式调用远程方法，并且想要在服务中处理多线程时，才有必要使用 AIDL
- 如果需要调用远程方法，但不需要处理并发 IPC，就应该通过实现一个 Binder 创建接口
- 如果您想执行 IPC，但只是传递数据，不涉及方法调用，也不需要高并发，就使用 Messenger 来实现接口
- 如果需要处理一对多的进程间数据共享（主要是数据的 CRUD），就使用 ContentProvider
- 如果要实现一对多的并发实时通信，就使用 Socket
## 数据通讯-EventBus事件总线
进程内线程间（内）通信
```
                +-------------+
                |             |
                | publisher   | EventBus.getDefault()
                |             |
                +-----+-------+
                      |
                      |
                      |   +------------+
        postSticky()  |   |            |
        post()        |   |  event     | POSTING，MAIN，BACKGROUND，ASYNC
                      |   |(class type)|
                      v   +------------+

                +------------------------------------------------------------------+
                |         +------+            +------+                             |
event bus       |         | event|            | event|                             |
                |         |      |            |      |                             |
                |         +------+            +------+                             |
                +-------------------------+----------------------+-----------------+
                                        |                      |
                                        |                      |
                                        v                      v

                                +-------------+       +-------------+
                                |             |       |             |
                register        | subscriber  |       | subscriber  |
                                | @Subscrie   |       | @Subscrie   |
                                | eventMethod |       | eventMethod |
                                +-------------+       +-------------+


```

## 数据对象依赖注入解耦 -Dagger2 依赖注入框架

 
```
 ----------------------------------------------------->


+---------------------------------------+----------------------------+---------------+
|             ViewClass                 |      @Inject               |               |
|                                       +-----------------------+    |               |
+------------+-------------+------------+  @Component           |    |               |
|            |             |   |        | (modules, dependencys)|    |               |
|            |             |   | @Scope | ComponentInterface    |    |               |
|            |             |   |        |                       |    |InjectDataClass|
|            |             |   +--------+---------------+       |    |/PresenterClass|
|            |             |            @Module         |       |    |               |
|            |             |                            |       |    |               |
|            |             |           ModuleClass      |       |    |               |
|            |             |                            |       |    |               |
| @Named     | @Singleton  |----------------------------+-------+----+               |
|            |             |            |                            |               |
| @Qualifier |             | @Scope     |      @provide              |               |
|            |             |            |      provideDataMethod     |               |
+------------+-------------+------------+----------------------------+---------------+



```



对象依赖注入方式： 接口，set方法,构造方法,Java注解
   Dagger2 依赖注入控制反转，Dagger 2 是 Java 和 Android 下的一个完全静态、编译时生成代码的依赖注入框架
，完全去除了反射。

Dagger2解决了这些问题，帮助我们管理实例，并进行解耦。

 解决android View与presenter解耦


 1. 注入数据类 @Inject
 2. 关联数据类 @Module @Provides
 3. 注解生成路径

**@Inject** 注解生成的代码。初始化数据对象的代码，用于稍后component关联Activity和数据类
 **Dagger\app\build\generated\source\apt\debug\edu\ptu\java\dagger\MainActivity_MembersInjector.java**


**@Modul** 类下的 **@Provides** 注解生成的代码。缓存Module类的代码
**Dagger\app\build\generated\source\apt\debug\edu\ptu\java\dagger\DataModule_ProvidesAFactory.java**



 4. 使用@Component 关联 @Inject 数据类 与 @Module 数据提供类
@Component生成的代码。调用 **injectActivity** 向包含 **@Inject** 的Activity 注入数据类
**Dagger\app\build\generated\source\apt\debug\edu\ptu\java\dagger\DaggerDataComponent.java**


**@Scope** 注解如何保证依赖在 component 生命周期内的单例性


### dagger.android

[AndroidInjector](https://segmentfault.com/a/1190000010016618)

```
+--------------------------------+ +--------------------------------+
|                                | |                                |
| AndroidInjection.inject(this); | | AndroidInjection.inject(this); |          +-----------------------------------+
|                                | |                                |          | @Module                           |
+--------------------------------+ +--------------------------------+          | ActModule1                        |
                                                                               |                                   |
                 ^                          ^                    +-------------+     @ContributesAndroidInjectortor|
                 |                          |                    |             +-----------------------------------+
                 |                          |                    |
                 |                          |                    |             +------------------------------------------+
+----------------+--------------------------+-------+            |             | +------------------------------------+   |
| App:HasActivityInjector                           |            |             | |  @SubComponent                     |   |
+---------------------------------------------------+    <-------+             | |  ActSubComponent:AndroidInjector   |   |
|                                                   |                          | |                                    |   |
|    AppComponent:@AndroidInjectionModule.class     |                          | |        @Subcomponent.Builder       |   |
|                                                   |    <---------------------+ +------------------------------------+   |
|                :ActModule1,ActModule2             |                          | +------------------------------------+   |
|                                                   |                          | |  @Module                           |   |
|          DispatchingAndroidInjector               |                          | |  ActModule2                        |   |
+---------------------------------------------------+                          | |                                    |   |
                                                                               | +------------------------------------+   |
                                                                               +------------------------------------------+
  
```

@Component dependencies 和 @SubComponent 两种方式关联Comonponent


MVP+daggers
1. 如何再Activivty注入(@Inject)Presenter

 

## 数据异步链式开发框架-Rxjava+Rxlife
RxJava2.0是非常好用的一个异步链式库,响应式编程，遵循观察者模式。
```

+--------------------------+        +----------------------------+       +------------------------------+
|                          |        |                            |       |                              |
|     create layer         |        |     subscribe call layer   |       |    execute call layer        |
|                          |        |                            |       | (subscriber/observer method) |
+--------------------------+        +----------------------------+       +------------------------------+
|                          |        |                            |       |                              |
|    +---------------+     |        |    +-------------------+   |       |     +---------------------+  |
|    |    create()   |     |        |    |                   |   |       |     |                     |  |
|    |     just()    |     |        |    |subscribe(observer)|---------------> |   call()            |  |
|    |     from()    |     |        |    |                   |   |       |     |                     |  |
|    +-------+-------+     |        |    +-------------------+   |       |     +---------+-----------+  |
|            |             |        |                            |       |               |              |
|            |             |        |             ^              |       |               v              |
|            v             |        |             |              |       |                              |
|                          |        |             |              |       |     +---------------------+  |
|    +---------------+     |        |    +--------+----------+   |       |     |                     |  |
|    | map<Obj,Str>()|     |        |    |                   |   |       |     |   onNext()          |  |
|    | flatMap ()    |     |        |    |subscribe(observer)|   |       |     |                     |  |
|    |  compose()    |     |        |    |                   |   |       |     +----------+----------+  |
|    +-------+-------+     |        |    +-------------------+   |       |                |             |
|            |             |        |                            |       |                v             |
|            v             |        |             ^              |       |                              |
|                          |        |             |              |       |                              |
|    +---------------+     |        |    +--------+----------+   |       |     +---------------------+  |
|    |               |     |        |    |                   |   |       |     |                     |  |
|    |   observeOn() | +---------------> |subscribe(observer)|   |       |     |   switch thread     |  |
|    | subscribeOn(  |     |        |    |                   |   |       |     |                     |  |
|    |   Schedulers) |     |        |    +-------------------+   |       |     +---------------------+  |
|    +---------------+     |        |                            |       |                              |
|                          |        |                            |       |                              |
+--------------------------+        +----------------------------+       +------------------------------+

```

需要有订阅，Observable才会执行

[rx操作符](http://reactivex.io/documentation/operators.html)

```
+------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                                                                |
|                                                                                                                                                |
|                                                                                                                                                |
|  Create                  Debounce                              Delay                                                                           |
|  Defer                   Distinct                              Do                                                                              |
|  Empty                   ElementAt                             Materialize                                                                     |
|  /Never                  Filter                                /Dematerialize All                                                              |
|  /Throw                  First                                 ObserveOn      Amb                                                              |
|  From      Buffer        IgnoreElement  And/Then/When          Serialize      Contains          Average                                        |
|  Interval  FlatMap       Last           CombineLatest          Subscribe      DefaultIfEmpty    Concat                                         |
|  Just      GroupBy       Sample         Join                   SubscribeOn    SequenceEqual     Count                                          |
|  Range     Map           Skip           Merge                  TimeInterval   SkipUntil         Max                         Connect            |
|  Repeat    Scan          SkipLast       StartWith              Timeout        SkipWhile         Min                         Publish            |
|  Start     Window        Take           Switch        Catch    Timestamp      TakeUntil         Reduce                      RefCount           |
|  Timer                   TakeLast       Zip           Retry    Using          TakeWhile         Sum                         Replay        to   |
+------------------------------------------------------------------------------------------------------------------------------------------------+
|  Creating  Transforming  Filtering     Combining      Error    Utility        Conditional     Mathematical                                     |
|                                                       Handling                and Boolean     and Aggregate  Backpressure  Connectable  Convert|
+------------------------------------------------------------------------------------------------------------------------------------------------+

```
[Rxjava Operater](https://github.com/ReactiveX/RxJava/wiki/Alphabetical-List-of-Observable-Operators)
```
+----------------------------------+--------------------------------------+----------------+-----------------------+
|                                  |                                      |                |                       |
|deferFuture( )    runAsync( )     | getIterator( )                       |                |                       |
|                                  | toIterable( )      mostRecent( )     |                | stringConcat( )       |
|startFuture( )    fromRunnable( ) |  toFuture( )       lastOrDefault( )  |                |                       |
|                                  | singleOrDefault( ) last( )           |                | join( )   split( )    |
|toAsync( )        fromCallable( ) |  single( )         firstOrDefault( ) |                |                       |
|or asyncAction( )                 |                    first( )          |                | encode( )   from( )   |
|or asyncFunc( )   fromAction( )   |  latest( )                           | Flowable       |                       |
|                                  |                    forEach( )        |                | decode( )   byLine( ) |
|start( )          forEachFuture( )|   next( )                            |                |                       |
+------------------------------------------------------------------------------------------------------------------+
|        Async                     |             Blocking Observable      | Parallel flows |    String             |
+----------------------------------+--------------------------------------+----------------+-----------------------+


```
背压策略：即生产者的速度大于消费者的速度带来的问题，比如在Android中常见的点击事件，点击过快则经常会造成点击两次的效果。
Flowable背压策略
```
onBackpressureBuffer()
onBackpressureDrop()
onBackpressureLatest() 

```

Rxjava Scheduler / Worker / Runnable 

```
+-----------------+---------------------------------------------------------------------------+
|                 |                             Schedulers                                    |
+--------------------------------------+------------------------------------------------------+
|                 |computation() |io() | trampoline() |newThread()|  single() |from(Executor) |
+---------------------------------------------------------------------------------------------+
|  corePoolSize   |              |1    |              |           |           |               |
+---------------------------------------------------------------------------------------------+
|  maximumPoolSize|              |     |              |           |           |               |
+---------------------------------------------------------------------------------------------+
|  keepAliveTime  |              |     |              |           |           |               |
|                 |              |     |              |           |           |               |
+---------------------------------------------------------------------------------------------+
|  unit           |              |     |              |           |           |               |
+---------------------------------------------------------------------------------------------+
|  workQueue      |              |     |              |           |           |               |
+-----------------+--------------+-----+--------------+-----------+-----------+---------------+

```

## 数据路由 - Activity栈

## 数据路由 - ARouter
- apt技术
- spi技术

```
----------------------------------------------->


+-----------------------------+             +----------------------------+
|                             |             |                            |
|  @Route                     |             |  @Route                    |
|                             |             |                            |
|  Activity/   +--------------+             |  Activity/   +-------------+
|  Fragment/   |              |             |  Fragment/   |             |
|  Service     |  @AutoWire   |             |  Service     |  @AutoWire  | 
|              |              |             |              |             |
|              |  extraField  |             |              |  extraField |
+-----------------------------+             +----------------------------+
+----------------------------------------------------------------------------+
|                                                                            |
|                           @Interceptor                                     |
|                                                                            |
|                                                                            |
+----------------------------------------------------------------------------+


```

## 数据结构 - AAC
AAC是一套MVVM架构组件

```
               +--------------------------+
               |                          |
               |                          |
               |    Activity/Framgent     |
               |                          |
               +------------+-------------+
                            v

             +------------------------------+
             |                              |
             |      ViewModel +-------------+
             |                |  LiveData   |
             |                |             |
             +--------------+-+-------------+
                            |
                            v

             +------------------------------+
             |       Repository             |
        +----+                              +--+
        |    |                              |  |
        |    +------------------------------+  |
        v                                      v

+--------------------+       +---------------------+
|                    |       |                     |
|                    |       |                     |
|   Model            |       |   Remote Data Source|
|        +-----------+       |        +------------+
|        |  Room     |       |        |  Retrofit  |
|        |           |       |        |            |
+-------++-----------+       +--------+------------+
        |
        v

+--------------------+
|                    |
|   Sqlite           |
|                    |
+--------------------+

```

- LiveData 数据对象更新观察类
- ViewModel 提供了创建和检索（类似于单例）绑定到特定生命周期对象的方法，有生命周期的Presenter
- LifeCycle
- Room

## 插件 - RePlugin
- 生命周期管理
- res资源加载
- 插件Dex的加载


```
+------------------------------+                    +-----------------------------+
|                              |                    |                             |
|        Host Proj             |                    |        Main Plugin          |
|                              |                    |                             |
+------------------------------+                    +-----------------------------+
|                              |                    |                             |
|                              |                    |                             |
|                              |                    |                             |
|                              |                    |                             |
|                              |                    |                             |
|                              |                    |                             |
|                +-------------+                    |               +-------------+
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
|                |             |                    |               |             |
+----------------+-------------+                    +---------------+-------------+


```